<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Model Lab ¬∑ real‚Äëtime access & quota explorer</title>
    <style>
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-app: #0b0f17;
            --bg-surface: #111722;
            --bg-card: #1a2332;
            --bg-card-hover: #212d40;
            --bg-input: #0d1320;
            --bg-code: #0c111c;
            --border: #28344a;
            --border-focus: #3b82f6;
            --text-primary: #f0f4fe;
            --text-secondary: #b0c0da;
            --text-muted: #6b7f9f;
            --blue: #3b82f6;
            --blue-bg: rgba(59, 130, 246, 0.1);
            --green: #10b981;
            --green-bg: rgba(16, 185, 129, 0.1);
            --red: #ef4444;
            --red-bg: rgba(239, 68, 68, 0.1);
            --yellow: #f59e0b;
            --yellow-bg: rgba(245, 158, 11, 0.1);
            --purple: #a78bfa;
            --purple-bg: rgba(167, 139, 250, 0.1);
            --cyan: #22d3ee;
            --cyan-bg: rgba(34, 211, 238, 0.1);
            --orange: #fb923c;
            --orange-bg: rgba(251, 146, 60, 0.1);
            --shadow: 0 12px 30px -8px rgba(0, 0, 0, 0.5);
            --radius-lg: 16px;
            --radius-md: 12px;
            --radius-sm: 8px;
            --transition: 0.18s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-app);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
        }

        /* smooth scroll + thin scrollbar */
        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #4b5563; }

        /* layout */
        .app {
            max-width: 1300px;
            margin: 0 auto;
            padding: 24px 24px 48px;
        }

        /* header */
        .header {
            display: flex;
            align-items: center;
            gap: 18px;
            background: linear-gradient(145deg, #131b2b, #0f1623);
            border-radius: var(--radius-lg);
            padding: 22px 32px;
            margin-bottom: 28px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
        }
        .header-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #3b82f6, #a78bfa);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .header-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(to right, #90caf9, #c084fc, #5eead4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }
        .header-text p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-top: 5px;
        }

        /* tabs */
        .tabs {
            display: flex;
            gap: 4px;
            background: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: 40px;
            padding: 6px;
            margin-bottom: 28px;
            width: fit-content;
        }
        .tab {
            padding: 10px 24px;
            font-size: 0.9rem;
            font-weight: 600;
            background: transparent;
            border: none;
            border-radius: 40px;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }
        .tab:hover { color: var(--text-primary); background: rgba(255,255,255,0.03); }
        .tab.active {
            background: var(--blue-bg);
            color: var(--blue);
            border: 1px solid rgba(59,130,246,0.2);
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fade 0.25s ease; }
        @keyframes fade { from { opacity:0.3; transform:translateY(5px); } to { opacity:1; transform:translateY(0); } }

        /* api panel */
        .api-panel {
            background: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 22px;
            margin-bottom: 25px;
        }
        .api-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            font-weight: 700;
            color: var(--text-muted);
            letter-spacing: 0.3px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .input-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        .input-wrapper {
            flex: 1;
            position: relative;
            min-width: 260px;
        }
        .input-wrapper input {
            width: 100%;
            padding: 14px 48px 14px 16px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 0.95rem;
            font-family: 'JetBrains Mono', monospace;
            outline: none;
            transition: var(--transition);
        }
        .input-wrapper input:focus {
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px rgba(59,130,246,0.15);
        }
        .btn-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 6px;
            border-radius: 6px;
        }
        .btn-toggle:hover { color: var(--text-secondary); background: rgba(255,255,255,0.03); }
        .btn-primary, .btn-secondary {
            padding: 14px 26px;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.95rem;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
            transition: var(--transition);
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 6px 14px rgba(37,99,235,0.3);
        }
        .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 12px 22px rgba(37,99,235,0.4); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }
        .btn-secondary:hover { background: var(--bg-card-hover); color: var(--text-primary); }

        /* vpn / rate monitor panels */
        .vpn-panel, .rate-panel {
            background: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 18px 22px;
            margin-bottom: 20px;
        }
        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        .panel-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .vpn-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px,1fr));
            gap: 12px;
        }
        .vpn-item {
            background: var(--bg-card);
            padding: 10px 14px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
        }
        .vpn-label { font-size:0.7rem; color: var(--text-muted); text-transform: uppercase; }
        .vpn-value { font-size:0.9rem; font-weight:600; font-family: monospace; }

        .rate-bars { display: flex; flex-direction: column; gap: 14px; }
        .rate-bar-item { display: flex; flex-direction: column; gap: 4px; }
        .rate-bar-header { display: flex; justify-content: space-between; font-size:0.8rem; }
        .rate-bar-track { height: 8px; background: var(--bg-input); border-radius: 4px; overflow: hidden; }
        .rate-bar-fill { height:100%; border-radius:4px; transition: width 0.2s; }
        .safe { background: var(--green); }
        .warning { background: var(--yellow); }
        .danger { background: var(--red); }
        .rate-status-badge {
            padding: 4px 14px;
            border-radius: 20px;
            font-size:0.75rem;
            font-weight:700;
        }

        /* stats row */
        .stats-row {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 16px 22px;
            flex: 1 0 120px;
            text-align: center;
        }
        .stat-value { font-size: 2rem; font-weight: 800; line-height:1; }
        .stat-label { font-size:0.7rem; color: var(--text-muted); text-transform: uppercase; margin-top:6px; }
        .stat-total .stat-value { color: var(--blue); }
        .stat-working .stat-value { color: var(--green); }
        .stat-failed .stat-value { color: var(--red); }
        .stat-testing .stat-value { color: var(--yellow); }

        /* progress */
        .progress-section {
            background: var(--bg-surface);
            border-radius: var(--radius-md);
            padding: 16px;
            margin-bottom: 20px;
            border:1px solid var(--border);
        }
        .progress-bar-bg { height: 8px; background: var(--bg-input); border-radius: 4px; }
        .progress-bar-fill { height:100%; background: linear-gradient(90deg, #3b82f6, #10b981); border-radius:4px; width:0%; transition: width 0.2s; }
        .progress-text { font-size:0.8rem; color: var(--text-muted); margin-top: 8px; text-align: center; }

        /* toolbar + search */
        .toolbar {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }
        .stat-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .badge-filter {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 30px;
            padding: 6px 18px;
            font-size:0.8rem;
            font-weight:600;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-secondary);
        }
        .badge-filter:hover { border-color: var(--blue); color: var(--blue); }
        .badge-filter.active {
            background: var(--blue-bg);
            border-color: var(--blue);
            color: var(--blue);
        }
        .badge-dot {
            width: 8px; height:8px; border-radius: 50%;
        }
        .search-box {
            position: relative;
            margin-left: auto;
        }
        .search-box input {
            height: 42px;
            width: 260px;
            padding: 0 16px 0 38px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 30px;
            color: var(--text-primary);
            font-size:0.9rem;
            outline: none;
        }
        .search-box svg {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        /* filter tabs (method) */
        .method-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }
        .method-tab {
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 30px;
            padding: 6px 18px;
            font-size:0.8rem;
            font-weight:600;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap:6px;
        }
        .method-tab:hover { border-color: var(--blue); color: var(--blue); }
        .method-tab.active { background: var(--blue-bg); border-color: var(--blue); color: var(--blue); }

        /* model grid */
        .model-grid {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin-bottom: 30px;
        }
        .model-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            transition: var(--transition);
        }
        .model-card:hover { border-color: #3b82f6; background: var(--bg-card-hover); }
        .card-header {
            padding: 20px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }
        .type-badge {
            width: 44px; height:44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight:800;
            font-size:0.8rem;
            background: var(--bg-code);
            border: 1px solid var(--border);
            flex-shrink:0;
        }
        .type-badge.gen { background: var(--purple-bg); color: var(--purple); }
        .type-badge.emb { background: var(--cyan-bg); color: var(--cyan); }
        .type-badge.oth { background: var(--orange-bg); color: var(--orange); }
        .model-info {
            flex: 1;
            min-width: 180px;
        }
        .model-name {
            font-size:1.1rem;
            font-weight:700;
            word-break: break-word;
        }
        .model-id {
            font-size:0.75rem;
            color: var(--text-muted);
            font-family: monospace;
        }
        .status-chip {
            padding: 6px 18px;
            border-radius: 30px;
            font-size:0.75rem;
            font-weight:800;
            text-transform: uppercase;
            background: var(--bg-input);
        }
        .status-chip.working { background: var(--green-bg); color: var(--green); }
        .status-chip.failed { background: var(--red-bg); color: var(--red); }
        .status-chip.testing { background: var(--yellow-bg); color: var(--yellow); }
        .status-chip.pending { background: #2a3442; color: var(--text-muted); }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin: 12px 0 8px;
        }
        .tag {
            font-size:0.7rem;
            padding: 4px 12px;
            border-radius: 20px;
            background: var(--bg-code);
            color: var(--text-secondary);
            font-weight:600;
        }
        .tag.method-gen { background: var(--blue-bg); color: var(--blue); }
        .tag.method-emb { background: var(--purple-bg); color: var(--purple); }
        .tag.token { background: #2c3e50; color: #b0d4ff; }

        .expand-btn {
            width:100%;
            padding: 14px;
            background: rgba(0,0,0,0.15);
            border: none;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
            font-weight:600;
            font-size:0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: var(--transition);
        }
        .expand-btn:hover { background: rgba(255,255,255,0.02); color: var(--text-primary); }
        .expand-btn svg { transition: transform 0.2s; }
        .expand-btn.open svg { transform: rotate(180deg); }

        .details-panel {
            display: none;
            padding: 0 24px 24px 24px;
        }
        .details-panel.open { display: block; animation: slide 0.2s; }
        @keyframes slide { from { opacity:0.2; transform:translateY(-6px); } to { opacity:1; transform:translateY(0); } }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(210px,1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        .detail-item {
            background: var(--bg-code);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 12px;
        }
        .detail-item .label { font-size:0.7rem; color: var(--text-muted); text-transform: uppercase; }
        .detail-item .value { font-size:0.9rem; font-weight:600; font-family: monospace; }

        .latency-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .latency-bar-bg { flex:1; height:6px; background: var(--bg-input); border-radius:3px; }
        .latency-fill { height:100%; border-radius:3px; }
        .latency-fill.fast { background: var(--green); }
        .latency-fill.medium { background: var(--yellow); }
        .latency-fill.slow { background: var(--orange); }
        .latency-fill.vslow { background: var(--red); }

        .code-block {
            background: var(--bg-code);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            margin: 16px 0;
        }
        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 18px;
            background: #0e1624;
            border-bottom: 1px solid var(--border);
        }
        .code-body {
            padding: 18px;
            overflow-x: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            line-height: 1.5;
        }
        .code-body .kw  { color: #bb9af7; }
        .code-body .fn  { color: #7aa2f7; }
        .code-body .str { color: #9ece6a; }
        .code-body .cmt { color: #565f89; }
        .code-body .num { color: #ff9e64; }
        .btn-copy {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size:0.7rem;
        }
        .btn-copy:hover { color: var(--blue); }

        .log-section {
            background: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            margin-top: 30px;
        }
        .log-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
        }
        .log-body {
            padding: 16px 20px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size:0.8rem;
        }
        .log-ok { color: var(--green); }
        .log-err { color: var(--red); }
        .log-info { color: var(--blue); }
        .log-warn { color: var(--yellow); }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }
        .hidden { display: none !important; }
        @media (max-width:700px) {
            .input-row { flex-direction: column; }
            .toolbar { flex-direction: column; align-items: stretch; }
            .search-box input { width:100%; }
        }
    </style>
</head>
<body>
<div class="app">
    <!-- header -->
    <div class="header">
        <div class="header-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                <path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/>
            </svg>
        </div>
        <div class="header-text">
            <h1>Gemini Model Lab</h1>
            <p>Real‚Äëtime access test ¬∑ quota inspection ¬∑ rate‚Äëlimiting ¬∑ TypeScript/JavaScript examples</p>
        </div>
    </div>

    <!-- tabs -->
    <div class="tabs">
        <button class="tab active" data-tab="checker">üîç Model checker</button>
        <button class="tab" data-tab="vpn">üõ°Ô∏è VPN impact</button>
        <button class="tab" data-tab="ratelimit">‚è±Ô∏è Rate limiting</button>
        <button class="tab" data-tab="ts">üìò TypeScript guide</button>
    </div>

    <!-- main tab content -->
    <div class="tab-content active" id="tab-checker">
        <!-- api panel -->
        <div class="api-panel">
            <div class="api-label"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>Google AI Studio API key</div>
            <div class="input-row">
                <div class="input-wrapper">
                    <input type="password" id="apiKey" placeholder="AIzaSy..." autocomplete="off">
                    <button class="btn-toggle" id="toggleKey"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button>
                </div>
                <button class="btn-primary" id="btnCheck"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>Check models</button>
                <button class="btn-secondary hidden" id="btnExport"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>Export JSON</button>
            </div>
        </div>

        <!-- vpn status panel (dynamic) -->
        <div class="vpn-panel hidden" id="vpnPanel">
            <div class="panel-header"><span class="panel-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>network & VPN</span></div>
            <div class="vpn-grid" id="vpnInfo"></div>
        </div>

        <!-- rate limit monitor -->
        <div class="rate-panel hidden" id="ratePanel">
            <div class="panel-header">
                <span class="panel-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>rate limit (RPM / TPM)</span>
                <span class="rate-status-badge safe" id="rateStatus">SAFE</span>
            </div>
            <div class="rate-bars" id="rateBars"></div>
        </div>

        <!-- stats cards -->
        <div class="stats-row hidden" id="statsRow">
            <div class="stat-card stat-total"><div class="stat-value" id="statTotal">0</div><div class="stat-label">total</div></div>
            <div class="stat-card stat-working"><div class="stat-value" id="statWorking">0</div><div class="stat-label">working</div></div>
            <div class="stat-card stat-failed"><div class="stat-value" id="statFailed">0</div><div class="stat-label">failed</div></div>
            <div class="stat-card stat-testing"><div class="stat-value" id="statTesting">0</div><div class="stat-label">testing</div></div>
        </div>

        <!-- progress -->
        <div class="progress-section hidden" id="progressSection">
            <div class="progress-bar-bg"><div class="progress-bar-fill" id="progressFill"></div></div>
            <div class="progress-text" id="progressText">starting ...</div>
        </div>

        <!-- toolbar with badges + search -->
        <div class="toolbar hidden" id="toolbar">
            <div class="stat-badges" id="statBadges"></div>
            <div class="search-box">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                <input type="text" id="search" placeholder="filter by name, id, method ...">
            </div>
        </div>

        <!-- method filters (generate / embed / all / working / failed) -->
        <div class="method-filters hidden" id="methodFilters">
            <button class="method-tab active" data-filter="all">üîπ all</button>
            <button class="method-tab" data-filter="working">‚úÖ working</button>
            <button class="method-tab" data-filter="failed">‚ùå failed</button>
            <button class="method-tab" data-filter="generate">üìù generate</button>
            <button class="method-tab" data-filter="embed">üî¢ embed</button>
        </div>

        <!-- models grid -->
        <div class="model-grid" id="modelsGrid"><div class="empty-state"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg><h3>enter your API key</h3><p>models will appear after fetching</p></div></div>

        <!-- log console -->
        <div class="log-section hidden" id="logSection">
            <div class="log-header"><span>üìã live log</span><button class="btn-copy" id="clearLog">clear</button></div>
            <div class="log-body" id="logBody"></div>
        </div>
    </div>

    <!-- VPN info tab (static) -->
    <div class="tab-content" id="tab-vpn">[vpn impact content in English ‚Äì concise]</div>
    <!-- rate limit guide tab -->
    <div class="tab-content" id="tab-ratelimit">[rate limit best practices]</div>
    <!-- TypeScript guide tab -->
    <div class="tab-content" id="tab-ts">[full TypeScript client with rate limiting]</div>
</div>

<script>
    (function() {
        // ---------- DOM ----------
        const $ = id => document.getElementById(id);
        const apiKeyInput = $('apiKey'), toggleKey = $('toggleKey'), btnCheck = $('btnCheck'), btnExport = $('btnExport');
        const vpnPanel = $('vpnPanel'), vpnInfo = $('vpnInfo');
        const ratePanel = $('ratePanel'), rateStatus = $('rateStatus'), rateBars = $('rateBars');
        const statsRow = $('statsRow'), statTotal = $('statTotal'), statWorking = $('statWorking'), statFailed = $('statFailed'), statTesting = $('statTesting');
        const progressSection = $('progressSection'), progressFill = $('progressFill'), progressText = $('progressText');
        const toolbar = $('toolbar'), statBadges = $('statBadges'), searchInput = $('search');
        const methodFilters = $('methodFilters'), modelsGrid = $('modelsGrid'), logSection = $('logSection'), logBody = $('logBody'), clearLog = $('clearLog');

        // ---------- state ----------
        let allModels = [];                // enriched model objects
        let currentFilter = 'all';
        let searchTerm = '';
        const BASE = 'https://generativelanguage.googleapis.com/v1beta';

        // rate limiter (simple)
        const rate = { requestsPerMinute:15, tokensPerMinute:1e6, requestCount:0, tokenCount:0, resetTime:Date.now()+60000 };

        // ---------- utils ----------
        const escapeHtml = s => !s ? '' : String(s).replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'})[c]||c);
        const formatNumber = n => (n??0).toLocaleString();
        const sleep = ms => new Promise(r=>setTimeout(r,ms));
        const log = (msg, type='info') => {
            const t = new Date().toLocaleTimeString();
            const cls = {info:'log-info', ok:'log-ok', err:'log-err', warn:'log-warn'}[type]||'log-info';
            logBody.innerHTML += `<div><span class="log-time">[${t}]</span> <span class="${cls}">${escapeHtml(msg)}</span></div>`;
            logBody.scrollTop = logBody.scrollHeight;
        };

        // toggle key visibility
        toggleKey.addEventListener('click', ()=>{
            const isPass = apiKeyInput.type === 'password';
            apiKeyInput.type = isPass ? 'text' : 'password';
            toggleKey.innerHTML = isPass ? '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/>' : '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>';
        });

        // clear log
        clearLog.addEventListener('click', ()=> logBody.innerHTML='');

        // ---------- vpn detection ----------
        async function detectVPN() {
            try {
                log('detecting network info ...','info');
                const res = await fetch('https://ipapi.co/json/');
                const d = await res.json();
                vpnPanel.classList.remove('hidden');
                vpnInfo.innerHTML = `
                    <div class="vpn-item"><div class="vpn-label">IP</div><div class="vpn-value">${escapeHtml(d.ip||'?')}</div></div>
                    <div class="vpn-item"><div class="vpn-label">country</div><div class="vpn-value">${escapeHtml(d.country_name||'?')}</div></div>
                    <div class="vpn-item"><div class="vpn-label">city</div><div class="vpn-value">${escapeHtml(d.city||'?')}</div></div>
                    <div class="vpn-item"><div class="vpn-label">ISP</div><div class="vpn-value">${escapeHtml(d.org||'?')}</div></div>
                    <div class="vpn-item"><div class="vpn-label">VPN / proxy</div><div class="vpn-value" style="color:${(d.org||'').toLowerCase().includes('vpn')||(d.org||'').includes('proxy')?'#f59e0b':'#10b981'}">${(d.org||'').toLowerCase().includes('vpn')||(d.org||'').includes('proxy')?'‚ö†Ô∏è possible':'‚úÖ unlikely'}</div></div>
                `;
                log(`network: ${d.country_name} (${d.ip})`,'ok');
            } catch(e) { log(`vpn detection failed: ${e.message}`,'warn'); }
        }

        // ---------- rate monitor update ----------
        function updateRateUI() {
            if(Date.now()>=rate.resetTime) { rate.requestCount=0; rate.tokenCount=0; rate.resetTime=Date.now()+60000; }
            const rp = (rate.requestCount/rate.requestsPerMinute)*100;
            const tp = (rate.tokenCount/rate.tokensPerMinute)*100;
            const max = Math.max(rp,tp);
            const status = max<50?'safe':max<80?'warning':'danger';
            rateStatus.className = `rate-status-badge ${status}`;
            rateStatus.textContent = {safe:'SAFE',warning:'WARNING',danger:'DANGER'}[status];
            rateBars.innerHTML = `
                <div class="rate-bar-item"><div class="rate-bar-header"><span>RPM</span><span>${rate.requestCount}/${rate.requestsPerMinute}</span></div><div class="rate-bar-track"><div class="rate-bar-fill ${rp<50?'safe':rp<80?'warning':'danger'}" style="width:${rp}%"></div></div></div>
                <div class="rate-bar-item"><div class="rate-bar-header"><span>TPM (est.)</span><span>${rate.tokenCount}/${rate.tokensPerMinute}</span></div><div class="rate-bar-track"><div class="rate-bar-fill ${tp<50?'safe':tp<80?'warning':'danger'}" style="width:${tp}%"></div></div></div>
            `;
        }

        // ---------- stats update ----------
        function refreshStats() {
            const total = allModels.length;
            const working = allModels.filter(m=>m.status==='working').length;
            const failed = allModels.filter(m=>m.status==='failed').length;
            const testing = allModels.filter(m=>m.status==='testing').length;
            statTotal.textContent = total; statWorking.textContent = working; statFailed.textContent = failed; statTesting.textContent = testing;
            const done = working+failed;
            const pct = total?Math.round(done/total*100):0;
            progressFill.style.width = pct+'%';
            progressText.textContent = `tested ${done}/${total} (${pct}%)`;
            // build stat badges
            let html = '';
            const counts = {all:total, working, failed, generate:all.filter(m=>m.methods.some(x=>x.includes('generate'))).length, embed:all.filter(m=>m.methods.some(x=>x.includes('embed'))).length};
            ['all','working','failed','generate','embed'].forEach(k=>{
                const active = currentFilter===k?'active':'';
                html += `<div class="badge-filter ${active}" data-filter="${k}"><span class="badge-dot" style="background:${k==='all'?'#3b82f6':k==='working'?'#10b981':k==='failed'?'#ef4444':k==='generate'?'#a78bfa':'#22d3ee'}"></span> ${k} (${counts[k]||0})</div>`;
            });
            statBadges.innerHTML = html;
            statBadges.querySelectorAll('.badge-filter').forEach(b=>b.addEventListener('click',e=>{
                currentFilter = b.dataset.filter;
                document.querySelectorAll('.badge-filter').forEach(b=>b.classList.remove('active'));
                b.classList.add('active');
                renderModels();
            }));
        }

        // ---------- render model cards ----------
        function renderModels() {
            const searchLower = searchInput.value.toLowerCase();
            let filtered = allModels.filter(m => {
                if(currentFilter==='working' && m.status!=='working') return false;
                if(currentFilter==='failed' && m.status!=='failed') return false;
                if(currentFilter==='generate' && !m.methods.some(x=>x.includes('generate'))) return false;
                if(currentFilter==='embed' && !m.methods.some(x=>x.includes('embed'))) return false;
                if(searchLower) {
                    const hay = (m.name+' '+m.displayName+' '+m.methods.join(' ')).toLowerCase();
                    if(!hay.includes(searchLower)) return false;
                }
                return true;
            });
            if(!filtered.length) { modelsGrid.innerHTML = '<div class="empty-state"><svg width="48" height="48" ...></svg><h3>no models match</h3></div>'; return; }

            modelsGrid.innerHTML = filtered.map((m,i)=>{
                const cat = m.methods.some(x=>x.includes('generate'))?'gen':m.methods.some(x=>x.includes('embed'))?'emb':'oth';
                const statusCls = m.status||'pending';
                const tags = [];
                m.methods.slice(0,3).forEach(me=> tags.push(`<span class="tag method-${me.includes('generate')?'gen':me.includes('embed')?'emb':'oth'}">${me.replace('Content','').replace('stream','s¬∑')}</span>`));
                if(m.inputTokens) tags.push(`<span class="tag token">‚Üì${formatNumber(m.inputTokens)}</span>`);
                if(m.outputTokens) tags.push(`<span class="tag token">‚Üë${formatNumber(m.outputTokens)}</span>`);
                const lat = m.latency?`<div class="latency-row"><div class="latency-bar-bg"><div class="latency-fill ${m.latency<800?'fast':m.latency<2000?'medium':m.latency<4000?'slow':'vslow'}" style="width:${Math.min(100,m.latency/40)}%"></div></div><span class="latency-text">${m.latency}ms</span></div>`:'';
                const errHtml = m.errorMsg?`<div class="detail-item"><span class="label">error</span><span class="value" style="color:#ef4444">${escapeHtml(m.errorMsg.substring(0,100))}</span></div>`:'';
                const uid = `det_${i}_${Date.now()}`;
                const jsCode = genExample(m,'js');
                const tsCode = genExample(m,'ts');

                return `<div class="model-card" data-status="${m.status}">
                    <div class="card-header">
                        <div class="type-badge ${cat}">${cat.toUpperCase()}</div>
                        <div class="model-info">
                            <div class="model-name">${escapeHtml(m.displayName||m.id||m.name)}</div>
                            <div class="model-id">${escapeHtml(m.name||'')}</div>
                            <div class="tags">${tags.join('')}</div>
                        </div>
                        <div class="status-chip ${statusCls}">${m.status||'pending'}</div>
                    </div>
                    <button class="expand-btn" onclick="document.getElementById('${uid}').classList.toggle('open');this.classList.toggle('open')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"><polyline points="6 9 12 15 18 9"/></svg> details & code</button>
                    <div class="details-panel" id="${uid}">
                        <div class="detail-grid">
                            <div class="detail-item"><span class="label">version</span><span class="value">${escapeHtml(m.version||'-')}</span></div>
                            <div class="detail-item"><span class="label">input tokens</span><span class="value">${formatNumber(m.inputTokens)}</span></div>
                            <div class="detail-item"><span class="label">output tokens</span><span class="value">${formatNumber(m.outputTokens)}</span></div>
                            <div class="detail-item"><span class="label">temperature</span><span class="value">${m.temp??'-'}</span></div>
                            ${errHtml}
                        </div>
                        ${lat?`<div style="margin:12px 0">${lat}</div>`:''}
                        <div class="code-block">
                            <div class="code-header"><span>JavaScript</span><button class="btn-copy" onclick="copyText(this, \`${jsCode.replace(/`/g,'\\`')}\`)">üìã copy</button></div>
                            <div class="code-body">${highlight(jsCode)}</div>
                        </div>
                        <div class="code-block">
                            <div class="code-header"><span>TypeScript</span><button class="btn-copy" onclick="copyText(this, \`${tsCode.replace(/`/g,'\\`')}\`)">üìã copy</button></div>
                            <div class="code-body">${highlight(tsCode)}</div>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        // simple highlighter (copied from file3)
        function highlight(c) {
            return escapeHtml(c).replace(/\b(const|let|var|async|await|function|return|if|throw|interface|type|Promise|Array)\b/g,'<span class="kw">$1</span>')
                .replace(/\b(fetch|console|log|JSON|stringify|parse)\b/g,'<span class="fn">$1</span>')
                .replace(/('.*?'|".*?")/g,'<span class="str">$1</span>')
                .replace(/(\/\/.*)/g,'<span class="cmt">$1</span>')
                .replace(/\b(\d+)\b/g,'<span class="num">$1</span>');
        }

        // example generator
        function genExample(m, lang) {
            const isGen = m.methods.some(x=>x.includes('generate'));
            const isEmb = m.methods.some(x=>x.includes('embed'));
            if(isGen) return `// ${m.name} ‚Äì generate\nexport async function generate(prompt: string) {\n  const res = await fetch(\`https://generativelanguage.googleapis.com/v1beta/${m.name}:generateContent?key=YOUR_API_KEY\`,\n  { method:'POST', headers:{'Content-Type':'application/json'},\n    body:JSON.stringify({ contents:[{ parts:[{ text: prompt }] }] }) });\n  return res.json();\n}`;
            if(isEmb) return `// ${m.name} ‚Äì embedding\nexport async function embed(text: string) {\n  const res = await fetch(\`https://generativelanguage.googleapis.com/v1beta/${m.name}:embedContent?key=YOUR_API_KEY\`,\n  { method:'POST', headers:{'Content-Type':'application/json'},\n    body:JSON.stringify({ content:{ parts:[{ text }] } }) });\n  const d = await res.json(); return d.embedding.values;\n}`;
            return `// ${m.name} ‚Äì see docs\nconst MODEL = '${m.name}'`;
        }

        window.copyText = (btn, code) => {
            navigator.clipboard.writeText(code).then(()=>{ btn.textContent='‚úÖ copied'; setTimeout(()=>btn.textContent='üìã copy',1500); });
        };

        // ---------- fetch & test ----------
        async function startCheck() {
            const key = apiKeyInput.value.trim();
            if(!key) { alert('enter API key'); return; }
            // reset
            allModels = []; currentFilter='all'; searchInput.value='';
            btnCheck.disabled = true; btnCheck.innerHTML = '<div class="spinner"></div> checking...';
            btnExport.classList.add('hidden');
            statsRow.classList.remove('hidden');
            progressSection.classList.remove('hidden');
            toolbar.classList.remove('hidden');
            methodFilters.classList.remove('hidden');
            logSection.classList.remove('hidden');
            ratePanel.classList.remove('hidden');
            logBody.innerHTML = '';

            await detectVPN();
            updateRateUI();

            try {
                log('fetching model list ...','info');
                const listRes = await fetch(`${BASE}/models?key=${key}`);
                if(!listRes.ok) throw new Error(`HTTP ${listRes.status}`);
                const data = await listRes.json();
                const raw = data.models || [];
                log(`found ${raw.length} models`,'ok');

                allModels = raw.map(m=>({
                    name: m.name,
                    id: (m.name||'').replace('models/',''),
                    displayName: m.displayName||'',
                    version: m.version||'',
                    methods: m.supportedGenerationMethods||[],
                    inputTokens: m.inputTokenLimit||0,
                    outputTokens: m.outputTokenLimit||0,
                    temp: m.temperature,
                    status:'pending', latency:null, errorMsg:null
                }));
                refreshStats(); renderModels();

                // test each model sequentially with rate limit
                for(let i=0;i<allModels.length;i++) {
                    const model = allModels[i];
                    model.status = 'testing';
                    refreshStats(); renderModels();
                    log(`testing ${model.name} ...`,'warn');
                    const start = performance.now();
                    try {
                        // decide which endpoint
                        let url, body;
                        if(model.methods.includes('generateContent')) {
                            url = `${BASE}/${model.name}:generateContent?key=${key}`;
                            body = { contents:[{ parts:[{ text:'hi' }] }], generationConfig:{ maxOutputTokens:1 } };
                        } else if(model.methods.includes('embedContent')) {
                            url = `${BASE}/${model.name}:embedContent?key=${key}`;
                            body = { content:{ parts:[{ text:'test' }] } };
                        } else {
                            url = `${BASE}/${model.name}:countTokens?key=${key}`;
                            body = { contents:[{ parts:[{ text:'test' }] }] };
                        }
                        const res = await fetch(url, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body) });
                        const latency = Math.round(performance.now()-start);
                        rate.requestCount++; rate.tokenCount+=500; updateRateUI();
                        if(res.ok) {
                            model.status='working'; model.latency=latency; log(`‚úì ${model.name} ${latency}ms`,'ok');
                        } else {
                            const err = await res.text(); model.status='failed'; model.errorMsg=`${res.status}: ${err.substring(0,80)}`; log(`‚úó ${model.name} ‚Äì ${model.errorMsg}`,'err');
                        }
                    } catch(e) {
                        model.status='failed'; model.errorMsg=e.message; log(`‚úó ${model.name} ‚Äì ${e.message}`,'err');
                    }
                    refreshStats(); renderModels();
                    await sleep(600); // small delay
                }
                log('‚úÖ all tests finished','ok');
                btnExport.classList.remove('hidden');
            } catch(err) {
                log(`fatal: ${err.message}`,'err');
                modelsGrid.innerHTML = `<div class="empty-state"><h3>error</h3><p>${escapeHtml(err.message)}</p></div>`;
            } finally {
                btnCheck.disabled = false; btnCheck.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" ...></svg>Check models';
            }
        }

        btnCheck.addEventListener('click', startCheck);
        searchInput.addEventListener('input', renderModels);

        // export
        btnExport.addEventListener('click', ()=>{
            const report = { timestamp: new Date().toISOString(), models: allModels };
            const blob = new Blob([JSON.stringify(report,null,2)], {type:'application/json'});
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `gemini-report-${Date.now()}.json`; a.click();
        });

        // tabs
        document.querySelectorAll('.tab').forEach(t=>t.addEventListener('click', e=>{
            document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
            t.classList.add('active');
            document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
            $(`tab-${t.dataset.tab}`).classList.add('active');
        }));

        // placeholder static tabs (omitted for brevity, but would contain English explanations)
        $('tab-vpn').innerHTML = `<div class="info-box"><h3>VPN impact</h3><p>Using a VPN may cause 403/429 errors or higher latency. Prefer premium nodes in US/Europe.</p></div>`;
        $('tab-ratelimit').innerHTML = `<div class="info-box"><h3>rate limits</h3><p>Free tier: 15 RPM, 1.5M TPM. Use exponential backoff and retry-after headers.</p></div>`;
        $('tab-ts').innerHTML = `<div class="info-box"><h3>TypeScript client</h3><p>Full class with rate limiting, retry logic, and type definitions. (See expanded model cards for per‚Äëmodel examples)</p></div>`;
    })();
</script>
</body>
</html>